# replicasetでできること

- replicaの作成
manifestでレプリカの数を決められる。
```shell
spec:
  replicas: 3
```

- 配置されるnodeについて
```shell
$ kubectl get po -l app=sample-app -o wide
NAME                      READY   STATUS    RESTARTS   AGE   IP            NODE       NOMINATED NODE   READINESS GATES
sample-replicaset-487ss   1/1     Running   0          95s   10.244.0.19   minikube   <none>           <none>
sample-replicaset-7vv5l   1/1     Running   0          95s   10.244.0.18   minikube   <none>           <none>
sample-replicaset-nxpnj   1/1     Running   0          95s   10.244.0.17   minikube   <none>           <none>
```
minikubeだとシングルノードだが、EKSやGKEだとすべて異なるノードに立ててくれるため、可用性が高い。

## セルフヒーリング
podを一つ停止したとしても決められたレプリカの数になるように自動でpodが起動する。
```shell
# podを確認
$ kubectl get po -l app=sample-app -o wide
NAME                      READY   STATUS    RESTARTS   AGE   IP            NODE       NOMINATED NODE   READINESS GATES
sample-replicaset-487ss   1/1     Running   0          17m   10.244.0.19   minikube   <none>           <none>
sample-replicaset-7vv5l   1/1     Running   0          17m   10.244.0.18   minikube   <none>           <none>
sample-replicaset-nxpnj   1/1     Running   0          17m   10.244.0.17   minikube   <none>           <none>

# sample-replicaset-487ssを削除する
$ kubectl delete pod sample-replicaset-487ss
pod "sample-replicaset-487ss" deleted from default namespace

# もう一度podを確認
$ kubectl get po -l app=sample-app
NAME                      READY   STATUS    RESTARTS   AGE
sample-replicaset-7vv5l   1/1     Running   0          18m
sample-replicaset-nxpnj   1/1     Running   0          18m
sample-replicaset-qk9jg   1/1     Running   0          20s
sample-replicaset-qk9jgが新たに作成されたことを確認
```
## podの増減確認
describeオプションで確認できる
```shell
kubectl describe replicaset sample-replicaset
以下抜粋
Events:
  Type    Reason            Age    From                   Message
  ----    ------            ----   ----                   -------
  Normal  SuccessfulCreate  22m    replicaset-controller  Created pod: sample-replicaset-nxpnj
  Normal  SuccessfulCreate  22m    replicaset-controller  Created pod: sample-replicaset-487ss
  Normal  SuccessfulCreate  22m    replicaset-controller  Created pod: sample-replicaset-7vv5l
  Normal  SuccessfulCreate  4m10s  replicaset-controller  Created pod: sample-replicaset-qk9jg
  ```